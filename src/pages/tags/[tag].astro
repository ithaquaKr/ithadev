---
import { type CollectionEntry, getCollection } from "astro:content";
import Container from "@components/Container.astro";
import { WRITING } from "@consts";
import Layout from "@layouts/Layout.astro";

export async function getStaticPaths() {
	const posts = await getCollection("writing", ({ data }) => !data.draft);
	const tags = [...new Set(posts.flatMap((post) => post.data.tags || []))];

	return tags.map((tag) => ({
		params: { tag },
		props: {
			posts: posts.filter((post) => post.data.tags?.includes(tag)),
			tag,
		},
	}));
}

type Props = {
	posts: CollectionEntry<"writing">[];
	tag: string;
};

const { posts, tag } = Astro.props;

const sortedPosts = posts.sort(
	(a, b) => b.data.date.valueOf() - a.data.date.valueOf(),
);
---

<Layout
  title={`${tag} - ${WRITING.TITLE}`}
  description={`Posts tagged with ${tag}`}
>
	<Container>
		<div class="space-y-10">
			<!-- Posts -->
			<section class="animate space-y-2">
				<p class="text-[#8C8A88] dark:text-gray-400">
					Posts tagged with "{tag}"
				</p>
				<ul class="space-y-0 tabular-nums">
					{sortedPosts.map((post) => (
						<li>
							<a
								href={`/writing/${post.id}`}
								class="group flex items-baseline gap-3 py-1 hover:text-[#588285] transition-colors dark:hover:text-[#6B9B9E]"
							>
								<span class="text-[#8C8A88] text-sm shrink-0 dark:text-gray-500">
									{post.data.date.getFullYear()} Â· {String(post.data.date.getMonth() + 1).padStart(2, '0')}
								</span>
								<span class="text-[#2C2A28] group-hover:underline decoration-[#588285] underline-offset-2 dark:text-white dark:decoration-[#6B9B9E]">
									{post.data.title}
								</span>
							</a>
						</li>
					))}
				</ul>
			</section>
		</div>
	</Container>
</Layout> 
